FROM node:20-alpine3.16

ARG PAT_TOKEN \
    NEXT_PUBLIC_API_SECRET \
    NEXT_PUBLIC_BACKEND_URL_PORT \
    NEXT_PUBLIC_BACKEND_URL_DOMAIN_NAME \
    NEXT_PUBLIC_BACKEND_URL_PROTOCOL \
    PORT

ENV NEXT_PUBLIC_API_SECRET=${NEXT_PUBLIC_API_SECRET} \
    NEXT_PUBLIC_BACKEND_URL_PORT=${NEXT_PUBLIC_BACKEND_URL_PORT} \
    NEXT_PUBLIC_BACKEND_URL_DOMAIN_NAME=${NEXT_PUBLIC_BACKEND_URL_DOMAIN_NAME} \
    NEXT_PUBLIC_BACKEND_URL_PROTOCOL=${NEXT_PUBLIC_BACKEND_URL_PROTOCOL} \
    PORT=${PORT}

    
RUN mkdir -p /var/app/current

WORKDIR /var/app/current

COPY . .

# CMD ["sleep", "infinity"]
RUN npm ci

RUN npm run build

CMD [ "npm", "run", "start" ]
